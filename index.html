<!DOCTYPE html>
<html lang="tr">
<head>
    <meta name="google-adsense-account" content="ca-pub-2835215845925411">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oyun Merkezi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #ffeef2;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* Header Styles */
        .header {
            background-color: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
        }
        .menu-icon {
            position: absolute;
            left: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #ff6b9d;
        }
        .logo {
            position: absolute;
            left: 60px;
            font-size: 24px;
            font-weight: bold;
            color: #ff6b9d;
        }
        .search-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .search-bar {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ff6b9d;
            border-radius: 6px;
            outline: none;
            font-size: 14px;
        }
        .search-bar:focus {
            border-color: #ff6b9d;
        }
        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: -60px;
            top: 64px;
            width: 60px;
            height: calc(100% - 64px);
            background-color: #fff;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 999;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .sidebar.active {
            left: 0;
        }
        .sidebar:hover {
            width: 200px;
        }
        .sidebar-item {
            padding: 15px;
            display: flex;
            align-items: center;
            color: #666;
            text-decoration: none;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        .sidebar-item:hover {
            background-color: #fff5f7;
            color: #ff6b9d;
        }
        .sidebar-item i {
            font-size: 24px;
            min-width: 30px;
        }
        .sidebar-item span {
            margin-left: 10px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .sidebar:hover .sidebar-item span {
            opacity: 1;
        }
        /* Main Content */
        .container {
            display: flex;
            flex: 1;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            transition: padding-left 0.3s ease;
        }
        .container.sidebar-active {
            padding-left: 80px;
        }
        .content {
            flex: 1;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            text-align: center;
            min-width: 300px;
            max-width: 1200px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .game-container {
            width: 100%;
            max-width: 100%;
            position: relative;
            padding-top: 75%;
        }
        .game-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .ad {
            width: 300px;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
            font-size: 18px;
            color: #666;
        }
        .ad-left, .ad-right {
            height: 600px;
            min-height: 600px;
        }
        .ad-left {
            order: 1;
        }
        .ad-right {
            order: 3;
        }
        .ad-bottom {
            width: 100%;
            height: 90px;
            margin: 20px 0;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            color: #666;
        }
        .game-info {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff5f7;
            border-radius: 10px;
            text-align: left;
            width: 100%;
        }
        .game-info h2 {
            color: #ff6b9d;
            margin-bottom: 15px;
        }
        .game-info p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .game-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .game-tag {
            background-color: #ffe0e9;
            color: #ff6b9d;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        /* Category Styles */
        .category-section {
            width: 100%;
            margin-bottom: 40px;
            background-color: #fff5f7;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px dashed #ffe0e9;
            padding-bottom: 10px;
        }
        .category-title {
            font-size: 24px;
            color: #ff6b9d;
            font-weight: 600;
        }
        .view-all {
            color: #ff6b9d;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            padding: 5px 15px;
            background-color: #ffe0e9;
            border-radius: 20px;
            transition: background-color 0.2s;
        }
        .view-all:hover {
            background-color: #ffc1d6;
        }
        .game-scroll {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
            scrollbar-width: thin;
            scrollbar-color: #ff6b9d #ffe0e9;
            -webkit-overflow-scrolling: touch; /* iOS için pürüzsüz kaydırma */
            scroll-behavior: smooth; /* Pürüzsüz kaydırma */
            padding-bottom: 15px; /* Kaydırma çubuğu için yer */
        }
        .game-scroll::-webkit-scrollbar {
            height: 8px;
        }
        .game-scroll::-webkit-scrollbar-track {
            background: #ffe0e9;
            border-radius: 10px;
        }
        .game-scroll::-webkit-scrollbar-thumb {
            background-color: #ff6b9d;
            border-radius: 10px;
        }
        .game-scroll .game-card {
            min-width: 180px;
            max-width: 180px;
            transition: transform 0.3s ease;
            margin-bottom: 5px; /* Alt boşluk ekle */
        }
        .game-scroll .game-card:hover {
            transform: translateY(-8px);
        }
        
        /* Scroll Buttons */
        .scroll-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .scroll-btn {
            background-color: #ff6b9d;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .scroll-btn:hover {
            background-color: #ff4785;
        }
        .scroll-btn:disabled {
            background-color: #ffb8cb;
            cursor: not-allowed;
        }
        
        /* Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            width: 100%;
            margin-top: 20px;
        }
        .game-card {
            background-color: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .game-card-image-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #f5f5f5;
            overflow: hidden;
        }
        .game-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }
        .lazy-image {
            opacity: 0;
        }
        .lazy-image.loaded {
            opacity: 1;
        }
        .game-card-loading {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 107, 157, 0.2);
            border-top: 3px solid #ff6b9d;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            margin-top: -15px;
            margin-left: -15px;
            animation: spin 1s linear infinite;
        }
        .game-card-info {
            padding: 12px;
            background: linear-gradient(to bottom, #fff, #fff5f7);
        }
        .game-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .game-card-genre {
            font-size: 12px;
            color: #ff6b9d;
            background-color: #ffe0e9;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        /* Favori Butonu */
        .favorite-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .favorite-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }

        .favorite-btn i {
            color: #ccc;
            font-size: 16px;
            transition: color 0.3s ease;
        }

        .favorite-btn.active i {
            color: #ff6b9d;
        }

        .favorite-btn:hover i {
            color: #ff6b9d;
        }

        /* Bildirimler */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            border-left: 4px solid #4CAF50;
        }

        .notification.info {
            border-left: 4px solid #2196F3;
        }

        .notification.error {
            border-left: 4px solid #f44336;
        }

        .notification i {
            font-size: 16px;
        }

        .notification.success i {
            color: #4CAF50;
        }

        .notification.info i {
            color: #2196F3;
        }

        .notification.error i {
            color: #f44336;
        }

        .notification.fade-out {
            animation: slideOut 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 107, 157, 0.3);
            border-radius: 50%;
            border-top: 4px solid #ff6b9d;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Oyun Yükleme */
        .game-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #ff6b9d;
            z-index: 100;
        }

        .game-loading .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 15px;
        }

        /* Mobile Styles */
        @media (max-width: 1200px) {
            .ad-left, .ad-right {
                height: 600px;
                min-height: 600px;
            }
        }

        @media (max-width: 768px) {
            .search-container {
                padding: 0 50px;
            }
            .container {
                padding: 10px;
            }
            .container.sidebar-active {
                padding-left: 70px;
            }
            .content {
                margin: 0;
                width: 100%;
            }
            .game-container {
                padding-top: 100%;
            }
            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            .game-scroll .game-card {
                min-width: 150px;
                max-width: 150px;
            }
            .category-title {
                font-size: 20px;
            }
            .home-header {
                padding: 20px 15px;
            }
            .home-title {
                font-size: 28px;
            }
            .home-subtitle {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 10px;
            }
            .menu-icon {
                left: 10px;
            }
            .logo {
                left: 45px;
                font-size: 18px;
            }
            .search-container {
                padding: 0 40px;
            }
            .search-bar {
                font-size: 14px;
                padding: 8px 12px;
            }
            .container {
                padding: 5px;
            }
            .content {
                padding: 10px;
            }
            .game-info {
                padding: 15px;
            }
            .game-info h2 {
                font-size: 18px;
            }
            .game-info p {
                font-size: 14px;
            }
            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            .game-scroll .game-card {
                min-width: 130px;
                max-width: 130px;
            }
            .category-title {
                font-size: 16px;
            }
            .home-title {
                font-size: 24px;
            }
            .home-subtitle {
                font-size: 14px;
            }
            .category-section {
                padding: 15px;
                margin-bottom: 20px;
            }
        }

        .home-header {
            width: 100%;
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 20px;
            background: linear-gradient(to right, #ff6b9d, #ff8fb3);
            border-radius: 15px;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3);
        }
        .home-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .home-subtitle {
            font-size: 18px;
            opacity: 0.9;
        }

        /* Game View Styles */
        .game-view-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .game-view-content {
            display: flex;
            gap: 20px;
            width: 100%;
        }

        .game-container-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-ads-left, .game-ads-right {
            width: 160px;
            height: 600px;
            background-color: #f0f0f0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            position: sticky;
            top: 20px;
        }

        .ad-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
            font-size: 14px;
            color: #999;
            letter-spacing: 2px;
        }

        .ad-bottom {
            width: 100%;
            height: 90px;
            margin: 20px 0;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            color: #666;
        }

        /* Responsive Game View */
        @media (max-width: 1024px) {
            .game-ads-left, .game-ads-right {
                width: 120px;
            }
        }

        @media (max-width: 768px) {
            .game-view-content {
                flex-direction: column;
            }
            
            .game-ads-left, .game-ads-right {
                width: 100%;
                height: 100px;
                margin-bottom: 15px;
            }
            
            .game-ads-left .ad-text, .game-ads-right .ad-text {
                writing-mode: horizontal-tb;
                transform: none;
            }
            
            .game-ads-right {
                order: 3;
            }
            
            .game-container-wrapper {
                order: 2;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <i class="fas fa-bars menu-icon" id="menuIcon"></i>
        <div class="logo">Oyun Merkezi</div>
        <div class="search-container">
            <input type="text" class="search-bar" id="searchBar" placeholder="Search">
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <a href="#" class="sidebar-item" data-category="all">
            <i class="fas fa-gamepad"></i>
            <span>Tüm Oyunlar</span>
        </a>
        <a href="#" class="sidebar-item" data-category="action">
            <i class="fas fa-bolt"></i>
            <span>Aksiyon</span>
        </a>
        <a href="#" class="sidebar-item" data-category="adventure">
            <i class="fas fa-mountain"></i>
            <span>Macera</span>
        </a>
        <a href="#" class="sidebar-item" data-category="puzzle">
            <i class="fas fa-puzzle-piece"></i>
            <span>Bulmaca</span>
        </a>
        <a href="#" class="sidebar-item" data-category="strategy">
            <i class="fas fa-chess"></i>
            <span>Strateji</span>
        </a>
        <a href="#" class="sidebar-item" data-category="sports">
            <i class="fas fa-futbol"></i>
            <span>Spor</span>
        </a>
        <a href="#" class="sidebar-item" data-category="favorites">
            <i class="fas fa-heart"></i>
            <span>Favoriler</span>
        </a>
    </div>

    <div class="container" id="mainContainer">
        <div class="content" id="content">
            <!-- Ana Sayfa Görünümü -->
            <div id="homeView">
                <div id="gamesView">
                    <div class="loading" id="loadingIndicator">
                        <div class="loading-spinner"></div>
                    </div>
                    <!-- Kategorilere ayrılmış oyunlar buraya gelecek -->
                </div>
            </div>
            
            <!-- Kategori Görünümü -->
            <div id="categoryView" style="display: none;">
                <div class="category-view-header">
                    <button class="back-button" onclick="returnToHome()">Ana Sayfaya Dön</button>
                    <h2 class="category-view-title" id="categoryTitle">Kategori</h2>
                </div>
                <div class="games-grid" id="gamesGrid"></div>
            </div>
            
            <!-- Oyun Görünümü -->
            <div id="gameView" style="display: none;">
                <div class="game-view-navigation">
                    <button class="back-button" onclick="returnToHome()">Ana Sayfaya Dön</button>
                    <button class="back-button" onclick="returnToGames()">Kategoriye Dön</button>
                </div>
                
                <div class="game-view-content">
                    <div class="game-ads-left ad">
                        <span class="ad-text">Reklam Alanı</span>
                    </div>
                    
                    <div class="game-container-wrapper">
                        <div class="game-container" id="gameContainer">
                            <iframe 
                                id="gameFrame"
                                scrolling="none" 
                                frameborder="0">
                            </iframe>
                        </div>
                        
                        <div class="ad-bottom">
                            <span class="ad-text">Reklam Alanı</span>
                        </div>
                        
                        <div class="game-info" id="gameInfo">
                            <h2 id="gameTitle"></h2>
                            <p id="gameDescription"></p>
                            <h3>Nasıl Oynanır:</h3>
                            <p id="gameInstructions"></p>
                            <div class="game-tags" id="gameTags"></div>
                        </div>
                    </div>
                    
                    <div class="game-ads-right ad">
                        <span class="ad-text">Reklam Alanı</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Global hata yakalama
            window.addEventListener('error', function(e) {
                console.error('Global hata:', e.error);
                showNotification('Beklenmeyen bir hata oluştu!', 'error');
            });

            window.addEventListener('unhandledrejection', function(e) {
                console.error('Yakalanmamış Promise hatası:', e.reason);
                showNotification('Veri yükleme hatası!', 'error');
            });

            // DOM Elements
            const menuIcon = document.getElementById('menuIcon');
            const sidebar = document.getElementById('sidebar');
            const container = document.querySelector('.container');
            const searchBar = document.getElementById('searchBar');
            const gamesGrid = document.getElementById('gamesGrid');
            const gamesView = document.getElementById('gamesView');
            const gameView = document.getElementById('gameView');
            const gameFrame = document.getElementById('gameFrame');
            const gameTitle = document.getElementById('gameTitle');
            const gameDescription = document.getElementById('gameDescription');
            const gameInstructions = document.getElementById('gameInstructions');
            const gameTags = document.getElementById('gameTags');
            const loadingIndicator = document.getElementById('loadingIndicator');

            if (!loadingIndicator) {
                console.error('Loading indicator element not found');
                showNotification('Sayfa yükleme hatası!', 'error');
                return;
            }
            
            // Sidebar Toggle
            menuIcon.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                container.classList.toggle('sidebar-active');
            });

            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !menuIcon.contains(e.target) && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                    container.classList.remove('sidebar-active');
                }
            });
            
            // Arama çubuğu işlevselliği
            searchBar.addEventListener('input', debounce(async function() {
                const searchTerm = searchBar.value.trim();
                
                if (searchTerm.length < 2) {
                    // Ana sayfa görünümüne dön
                    showView('homeView');
                    return;
                }
                
                try {
                    // Yükleme göstergesini göster
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'flex';
                        loadingIndicator.innerHTML = '<div class="loading-spinner"></div><p style="margin-left: 15px; color: #ff6b9d; font-weight: bold;">Arama yapılıyor...</p>';
                    }

                    // Arama sonuçlarını al - önce API'den, sonra yerel verilerden
                    let searchResults = [];

                    try {
                        // API'den arama sonuçlarını al
                        const response = await fetch(`/api/games/search?query=${encodeURIComponent(searchTerm)}`);

                        if (!response.ok) {
                            throw new Error(`Arama hatası: ${response.status}`);
                        }

                        searchResults = await response.json();
                    } catch (apiError) {
                        console.log('API arama başarısız, yerel verilerden arama yapılıyor...', apiError.message);

                        // Yerel verilerden arama yap
                        searchResults = performLocalSearch(searchTerm);
                    }

                    // Kategori görünümünü arama sonuçlarıyla doldur
                    document.getElementById('categoryTitle').textContent = `"${searchTerm}" için Arama Sonuçları (${searchResults.length} sonuç)`;
                    populateCategoryView(searchResults);

                    // Kategori görünümünü göster
                    showView('categoryView');

                } catch (error) {
                    console.error('Arama yapılırken hata:', error);
                    showErrorMessage(`Arama yapılırken bir hata oluştu: ${error.message}`);
                } finally {
                    // Yükleme göstergesini gizle
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                }
            }, 500)); // 500ms gecikme ile debounce
            
            // Debounce fonksiyonu
            function debounce(func, wait) {
                let timeout;
                return function(...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), wait);
                };
            }

            // Yerel verilerden arama yapan fonksiyon
            function performLocalSearch(searchTerm) {
                const results = [];
                const searchLower = searchTerm.toLowerCase();

                // Tüm kategorilerdeki oyunları ara
                Object.keys(gamesByCategory).forEach(category => {
                    gamesByCategory[category].forEach(game => {
                        if (game && game.Title) {
                            const title = game.Title.toLowerCase();
                            const description = (game.Description || '').toLowerCase();
                            const developer = (game.Developer || '').toLowerCase();
                            const genres = Array.isArray(game.Genres) ? game.Genres.join(' ').toLowerCase() : '';
                            const tags = Array.isArray(game.Tags) ? game.Tags.join(' ').toLowerCase() : '';

                            // Başlık, açıklama, geliştirici, tür veya etiketlerde arama terimi var mı kontrol et
                            if (title.includes(searchLower) ||
                                description.includes(searchLower) ||
                                developer.includes(searchLower) ||
                                genres.includes(searchLower) ||
                                tags.includes(searchLower)) {

                                // Aynı oyunu birden fazla kez eklememek için kontrol et
                                const existingIndex = results.findIndex(r => r.Id === game.Id);
                                if (existingIndex === -1) {
                                    results.push(game);
                                }
                            }
                        }
                    });
                });

                console.log(`Yerel aramada "${searchTerm}" için ${results.length} sonuç bulundu`);
                return results;
            }

            // Yerel verilerden kategori filtreleme yapan fonksiyon
            function performLocalCategoryFilter(category) {
                const results = [];
                const categoryLower = category.toLowerCase();

                // Tüm kategorilerdeki oyunları kontrol et
                Object.keys(gamesByCategory).forEach(cat => {
                    gamesByCategory[cat].forEach(game => {
                        if (game && game.Title) {
                            const genres = Array.isArray(game.Genres) ? game.Genres : [];
                            const tags = Array.isArray(game.Tags) ? game.Tags : [];
                            const gameCategory = game.Category || '';
                            const gameGenre = game.Genre || '';

                            // Kategori eşleşmesi kontrol et
                            const matchesCategory = genres.some(g => g.toLowerCase() === categoryLower) ||
                                                  tags.some(t => t.toLowerCase() === categoryLower) ||
                                                  gameCategory.toLowerCase() === categoryLower ||
                                                  gameGenre.toLowerCase() === categoryLower ||
                                                  cat === category;

                            if (matchesCategory) {
                                // Aynı oyunu birden fazla kez eklememek için kontrol et
                                const existingIndex = results.findIndex(r => r.Id === game.Id);
                                if (existingIndex === -1) {
                                    results.push(game);
                                }
                            }
                        }
                    });
                });

                console.log(`Yerel kategori filtrelemede "${category}" için ${results.length} sonuç bulundu`);
                return results;
            }
            
            // Global değişkenler
            let gamesData = [];
            let filteredGames = [];
            let favoriteGames = [];
            let gameCategories = []; // Tüm kategorilerin listesi
            let gameCategoryMap = {}; // Kategori başına oyunları tutan obje
            let isDataLoading = false; // Veri yükleme durumunu tutan değişken
            let allGamesLoaded = false; // Tüm oyunların yüklenip yüklenmediğini kontrol eden değişken
            let gamesByCategory = { // Kategorilere göre oyunları saklayan nesne
                'action': [],
                'adventure': [],
                'arcade': [],
                'strategy': [],
                'rpg': [],
                'simulation': [],
                'sports': [],
                'racing': [],
                'puzzle': [],
                'shooter': [],
                'board': [],
                'card': [],
                'casual': [],
                'other': []
            };
            
            // Oyun verilerini yükleyen ana fonksiyon (JSON dosyasından)
            async function loadGamesData() {
                if (isDataLoading) return;

                try {
                    isDataLoading = true;

                    // Yükleme göstergesini hazırla
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'flex';
                        loadingIndicator.innerHTML = '<div class="loading-spinner"></div><p style="margin-left: 15px; color: #ff6b9d; font-weight: bold;">Oyun verileri yükleniyor...</p>';
                    }

                    // Önce API'den verileri çekmeyi dene
                    console.log('API\'den oyun verileri yükleniyor...');
                    let data = null;

                    try {
                        const response = await fetch('/api/games', {
                            method: 'GET',
                            headers: {
                                'Cache-Control': 'no-cache',
                                'Pragma': 'no-cache'
                            }
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP hatası: ${response.status} ${response.statusText}`);
                        }

                        data = await response.json();
                        console.log('API verisi başarıyla yüklendi!', data);
                    } catch (apiError) {
                        console.log('API başarısız, alternatif API deneniyor...', apiError.message);

                        // Alternatif API endpoint'ini dene
                        try {
                            const response = await fetch('/api/oyunlar', {
                                method: 'GET',
                                headers: {
                                    'Cache-Control': 'no-cache',
                                    'Pragma': 'no-cache'
                                }
                            });

                            if (!response.ok) {
                                throw new Error(`HTTP hatası: ${response.status} ${response.statusText}`);
                            }

                            data = await response.json();
                            console.log('Alternatif API verisi başarıyla yüklendi!', data);
                        } catch (altApiError) {
                            console.log('Alternatif API de başarısız, JSON dosyası yükleniyor...', altApiError.message);

                            // Son çare olarak JSON dosyasını direkt yükle
                            try {
                                const response = await fetch('./test-data.json', {
                                    method: 'GET',
                                    headers: {
                                        'Cache-Control': 'no-cache',
                                        'Pragma': 'no-cache'
                                    }
                                });

                                if (!response.ok) {
                                    throw new Error(`JSON dosyası yüklenemedi: ${response.status} ${response.statusText}`);
                                }

                                const jsonData = await response.json();
                                console.log('JSON dosyası başarıyla yüklendi!', jsonData);

                                // JSON formatını API formatına dönüştür
                                data = [];
                                if (jsonData && jsonData.segments && Array.isArray(jsonData.segments)) {
                                    jsonData.segments.forEach(segment => {
                                        if (segment.hits && Array.isArray(segment.hits)) {
                                            segment.hits.forEach(game => {
                                                data.push(game);
                                            });
                                        }
                                    });
                                }

                                if (data.length === 0) {
                                    throw new Error('JSON dosyasında oyun verisi bulunamadı');
                                }

                                console.log(`JSON dosyasından ${data.length} oyun yüklendi`);
                            } catch (jsonError) {
                                console.error('JSON dosyası yüklenirken hata:', jsonError);
                                throw new Error(`Tüm veri kaynakları başarısız: ${jsonError.message}`);
                            }
                        }
                    }

                    if (data && data.length > 0) {
                        await processFullGamesData(data);
                    } else {
                        throw new Error('Hiç oyun verisi bulunamadı');
                    }
                    
                } catch (error) {
                    console.error('Oyun verileri yüklenirken hata oluştu:', error);

                    // Son çare olarak demo verileri oluştur
                    console.log('Demo verileri oluşturuluyor...');
                    const demoGames = createDemoGames();
                    if (demoGames.length > 0) {
                        await processFullGamesData(demoGames);
                        showNotification('Demo verileri yüklendi. Gerçek veriler için sunucuyu kontrol edin.', 'info');
                    } else {
                        showErrorMessage(`Oyun verileri yüklenirken bir hata oluştu: ${error.message}`);
                    }
                } finally {
                    isDataLoading = false;
                }
            }

            // Demo oyun verileri oluştur
            function createDemoGames() {
                return [
                    {
                        Id: 'demo-1',
                        Title: 'Demo Oyun 1',
                        Description: 'Bu bir demo oyunudur. Gerçek veriler yüklenemediği için gösterilmektedir.',
                        Developer: 'Demo Geliştirici',
                        Genres: ['Action'],
                        Tags: ['demo', 'action'],
                        Assets: ['https://via.placeholder.com/300x180?text=Demo+Oyun+1'],
                        'Game URL': 'https://example.com/demo-game-1',
                        Instructions: 'Bu demo bir oyundur.'
                    },
                    {
                        Id: 'demo-2',
                        Title: 'Demo Oyun 2',
                        Description: 'Bu ikinci demo oyunudur.',
                        Developer: 'Demo Geliştirici',
                        Genres: ['Puzzle'],
                        Tags: ['demo', 'puzzle'],
                        Assets: ['https://via.placeholder.com/300x180?text=Demo+Oyun+2'],
                        'Game URL': 'https://example.com/demo-game-2',
                        Instructions: 'Bu demo bir bulmaca oyunudur.'
                    },
                    {
                        Id: 'demo-3',
                        Title: 'Demo Oyun 3',
                        Description: 'Bu üçüncü demo oyunudur.',
                        Developer: 'Demo Geliştirici',
                        Genres: ['Adventure'],
                        Tags: ['demo', 'adventure'],
                        Assets: ['https://via.placeholder.com/300x180?text=Demo+Oyun+3'],
                        'Game URL': 'https://example.com/demo-game-3',
                        Instructions: 'Bu demo bir macera oyunudur.'
                    }
                ];
            }
            
            // Hata mesajını gösteren yardımcı fonksiyon
            function showErrorMessage(message) {
                const gamesView = document.getElementById('gamesView');
                if (gamesView) {
                    gamesView.innerHTML = `
                        <div style="text-align: center; padding: 20px; margin-top: 30px;">
                            <h2 style="color: red; margin-bottom: 15px;">Veri Yükleme Hatası</h2>
                            <p style="color: #666; margin-bottom: 20px;">${message}</p>
                            <button id="retryButton" style="background-color: #ff6b9d; color: white; border: none; border-radius: 5px; padding: 12px 25px; cursor: pointer; font-size: 16px;">
                                Tekrar Dene
                            </button>
                        </div>
                    `;
                    
                    const retryButton = document.getElementById('retryButton');
                    if (retryButton) {
                        retryButton.addEventListener('click', () => {
                            loadGamesData();
                        });
                    }
                } else {
                    console.error('gamesView elementi bulunamadı');
                    
                    // Son çare olarak body'ye mesaj eklemeyi dene
                    const bodyMessage = document.createElement('div');
                    bodyMessage.innerHTML = `
                        <div style="text-align: center; padding: 20px; margin-top: 30px; background-color: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 500px; margin: 30px auto;">
                            <h2 style="color: red; margin-bottom: 15px;">Veri Yükleme Hatası</h2>
                            <p style="color: #666; margin-bottom: 20px;">${message}</p>
                            <button id="retryButtonAlt" style="background-color: #ff6b9d; color: white; border: none; border-radius: 5px; padding: 12px 25px; cursor: pointer; font-size: 16px;">
                                Tekrar Dene
                            </button>
                        </div>
                    `;
                    document.body.appendChild(bodyMessage);
                    
                    const retryButtonAlt = document.getElementById('retryButtonAlt');
                    if (retryButtonAlt) {
                        retryButtonAlt.addEventListener('click', () => {
                            loadGamesData();
                        });
                    }
                }
            }
            
            // Tüm oyun verilerini işle
            async function processFullGamesData(data) {
                try {
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    
                    // Veri kontrolü
                    if (!data) {
                        console.error("Veri yok veya geçersiz");
                        throw new Error("Veri yok veya geçersiz");
                    }

                    // Yükleme göstergesini güncelle
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = '<div class="loading-spinner"></div><p style="margin-left: 15px; color: #ff6b9d; font-weight: bold;">Oyunlar yükleniyor...</p>';
                    }

                    // Veri içeriğini konsola yazdır
                    console.log("Yüklenen veri:", JSON.stringify(data).substring(0, 500) + "...");

                    // Veri formatını kontrol et ve işle
                    let games = Array.isArray(data) ? data : [];

                    if (data.games && Array.isArray(data.games)) {
                        games = data.games;
                    }

                    if (!games || games.length === 0) {
                        console.error("Hiç oyun verisi bulunamadı");
                        throw new Error("Hiç oyun verisi bulunamadı");
                    }

                    console.log(`Toplam ${games.length} oyun işleniyor`);
                    allGamesLoaded = true;

                    // Mevcut kategori verilerini sıfırla
                    Object.keys(gamesByCategory).forEach(category => {
                        gamesByCategory[category] = [];
                    });

                    // Tüm oyunları kategorilere göre sınıflandır
                    for (let i = 0; i < games.length; i++) {
                        if (games[i]) {
                            categorizeGame(games[i]);
                        }
                        
                        // Her 100 oyunda bir arayüzü güncelle ki tarayıcı yanıt vermeyi sürdürsün
                        if (i % 100 === 0 && loadingIndicator) {
                            loadingIndicator.innerHTML = `
                                <div class="loading-spinner"></div>
                                <p style="margin-left: 15px; color: #ff6b9d; font-weight: bold;">
                                    Oyunlar yükleniyor... (${i}/${games.length})
                                </p>
                            `;
                            
                            // Yükleme ilerlemesini konsola yazdır
                            console.log(`Oyun işleniyor: ${i}/${games.length} (${Math.round(i/games.length*100)}%)`);
                            
                            // Async işlemi biraz beklet ki UI güncellenebilsin
                            await new Promise(resolve => setTimeout(resolve, 0));
                        }
                    }

                    // Her kategoride kaç oyun olduğunu göster (hata ayıklama için)
                    Object.keys(gamesByCategory).forEach(category => {
                        console.log(`${category} kategorisinde ${gamesByCategory[category].length} oyun var`);
                    });

                    // Ana sayfayı oluştur
                    createHomeView();

                    // Ana sayfayı göster
                    showView('homeView');

                    // Lazy loading'i başlat
                    setTimeout(() => {
                        setupLazyLoading();
                    }, 100);

                    // Yükleme göstergesini gizle
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }
                    
                } catch (error) {
                    console.error("Oyun verileri işlenirken hata:", error);
                    
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    if (loadingIndicator) {
                        loadingIndicator.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <p style="color: red; margin-bottom: 15px;">Veri işlenirken hata oluştu: ${error.message}</p>
                                <button id="retryButton" style="background-color: #ff6b9d; color: white; border: none; border-radius: 5px; padding: 12px 25px; cursor: pointer; font-size: 16px;">
                                    Tekrar Dene
                                </button>
                            </div>
                        `;
                        
                        const retryButton = document.getElementById('retryButton');
                        if (retryButton) {
                            retryButton.addEventListener('click', () => {
                                loadGamesData();
                            });
                        }
                    } else {
                        showErrorMessage(`Veri işlenirken hata oluştu: ${error.message}`);
                    }
                }
            }

            // Oyunu kategorilere göre sınıflandır
            function categorizeGame(game) {
                // Game objesi kontrolü
                if (!game || !game.Title) {
                    console.warn('Geçersiz oyun verisi:', game);
                    return;
                }
                
                // Oyunun kategorisini belirle
                let category = 'other'; // Varsayılan kategori
                
                // Olası kategori alanlarını kontrol et
                let possibleCategory = '';
                
                if (game.Type && typeof game.Type === 'string') {
                    possibleCategory = game.Type.toLowerCase();
                } else if (game.Category && typeof game.Category === 'string') {
                    possibleCategory = game.Category.toLowerCase();
                } else if (game.Genre && typeof game.Genre === 'string') {
                    possibleCategory = game.Genre.toLowerCase();
                } else if (game.Genres && Array.isArray(game.Genres) && game.Genres.length > 0) {
                    possibleCategory = game.Genres[0].toLowerCase();
                } else if (game.Tags && Array.isArray(game.Tags) && game.Tags.length > 0) {
                    // İlk etiketi kategori olarak kullan
                    possibleCategory = game.Tags[0].toLowerCase();
                }
                
                // Kategoriyi bilinenlere eşlemeye çalış
                const categoryMap = {
                    // İngilizce kategoriler
                    'action': 'action',
                    'adventure': 'adventure',
                    'arcade': 'arcade',
                    'strategy': 'strategy',
                    'rpg': 'rpg',
                    'role playing': 'rpg',
                    'role-playing': 'rpg',
                    'simulation': 'simulation',
                    'sim': 'simulation',
                    'sports': 'sports',
                    'racing': 'racing',
                    'puzzle': 'puzzle',
                    'shooter': 'shooter',
                    'fps': 'shooter',
                    'board': 'board',
                    'card': 'card',
                    'casual': 'casual',
                    
                    // Türkçe kategoriler
                    'aksiyon': 'action',
                    'macera': 'adventure',
                    'strateji': 'strategy',
                    'rol yapma': 'rpg',
                    'simulasyon': 'simulation',
                    'simülasyon': 'simulation',
                    'spor': 'sports',
                    'yarış': 'racing',
                    'bulmaca': 'puzzle',
                    'nişancı': 'shooter',
                    'zeka': 'puzzle',
                    'masa': 'board',
                    'kart': 'card',
                    'gündelik': 'casual'
                };
                
                // Kategoriyi normalize et
                category = categoryMap[possibleCategory] || 'other';
                
                // Kategori listesine ekle
                if (!gamesByCategory[category]) {
                    console.warn(`Bilinmeyen kategori: ${category}, 'other' olarak ekleniyor`);
                    category = 'other';
                }
                
                // Eğer oyun zaten eklenmediyse ekle
                const existingIndex = gamesByCategory[category].findIndex(g => g.Id === game.Id);
                if (existingIndex === -1) {
                    gamesByCategory[category].push(game);
                } else {
                    // Oyun zaten varsa güncelle
                    gamesByCategory[category][existingIndex] = game;
                }
                
                return category;
            }

            // Ana sayfa görünümünü oluştur
            function createHomeView(games) {
                const homeContainer = document.getElementById('gamesView');
                if (!homeContainer) {
                    console.error('gamesView elementi bulunamadı');
                    return;
                }
                
                homeContainer.innerHTML = '';
                
                // Ana başlık ekle
                const header = document.createElement('div');
                header.className = 'home-header';
                header.innerHTML = '<h1 class="home-title">Oyun Merkezi</h1><p class="home-subtitle">En iyi oyunları keşfedin</p>';
                homeContainer.appendChild(header);
                
                // Her kategori için bölüm oluştur
                let categoryCount = 0;
                
                // Kategorilere göre bölümler
                for (const category in gamesByCategory) {
                    if (gamesByCategory[category].length > 0) {
                        const categoryDisplayName = getCategoryDisplayName(category);
                        const section = document.createElement('div');
                        section.className = 'category-section';
                        
                        // Kategori başlığı
                        const categoryHeader = document.createElement('div');
                        categoryHeader.className = 'category-header';
                        categoryHeader.innerHTML = `
                            <div class="category-title">${categoryDisplayName}</div>
                            <a href="#" class="view-all" data-category="${category}">Tümünü Gör</a>
                        `;
                        
                        // Oyunları yatay kaydırmalı listele
                        const gameScroll = document.createElement('div');
                        gameScroll.className = 'game-scroll';
                        
                        // En fazla 10 oyun göster
                        const gamesToShow = gamesByCategory[category].slice(0, 10);
                        
                        // Oyun kartlarını oluştur
                        gamesToShow.forEach(game => {
                            const gameCard = createGameCard(game);
                            if (gameCard) {
                                gameScroll.appendChild(gameCard);
                            }
                        });
                        
                        // Kaydırma kontrolleri
                        const scrollControls = document.createElement('div');
                        scrollControls.className = 'scroll-controls';
                        scrollControls.innerHTML = `
                            <button class="scroll-btn scroll-left" data-target="${category}"><i class="fas fa-chevron-left"></i></button>
                            <button class="scroll-btn scroll-right" data-target="${category}"><i class="fas fa-chevron-right"></i></button>
                        `;
                        
                        // Bileşenleri birleştir
                        section.appendChild(categoryHeader);
                        section.appendChild(gameScroll);
                        section.appendChild(scrollControls);
                        
                        // Kategori bölümünü ekle
                        homeContainer.appendChild(section);
                        categoryCount++;
                        
                        // Kaydırma düğmelerine tıklama olayları ekle
                        section.querySelector('.scroll-left').addEventListener('click', function() {
                            const target = this.getAttribute('data-target');
                            const scrollElement = document.querySelector(`.category-section:nth-child(${categoryCount}) .game-scroll`);
                            scrollElement.scrollBy({ left: -400, behavior: 'smooth' });
                        });
                        
                        section.querySelector('.scroll-right').addEventListener('click', function() {
                            const target = this.getAttribute('data-target');
                            const scrollElement = document.querySelector(`.category-section:nth-child(${categoryCount}) .game-scroll`);
                            scrollElement.scrollBy({ left: 400, behavior: 'smooth' });
                        });
                        
                        // Tümünü gör bağlantısına tıklama olayı ekle
                        section.querySelector('.view-all').addEventListener('click', function(e) {
                            e.preventDefault();
                            const category = this.getAttribute('data-category');
                            // Kategori görünümünü göster
                            document.getElementById('categoryTitle').textContent = getCategoryDisplayName(category);
                            
                            // Kategori görünümündeki oyunları doldur
                            const categoryGames = gamesByCategory[category] || [];
                            populateCategoryView(categoryGames);
                            
                            // Kategori görünümünü göster
                            showView('categoryView');
                        });
                    }
                }
                
                // Eğer hiç kategori yoksa
                if (categoryCount === 0) {
                    homeContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <h2 style="color: #ff6b9d; margin-bottom: 20px;">Henüz oyun verisi bulunamadı</h2>
                            <p style="color: #666; margin-bottom: 20px;">Lütfen daha sonra tekrar deneyin veya veri kaynağını kontrol edin.</p>
                            <button id="retryButton" style="background-color: #ff6b9d; color: white; border: none; border-radius: 5px; padding: 12px 25px; cursor: pointer; font-size: 16px;">
                                Tekrar Dene
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('retryButton').addEventListener('click', function() {
                        loadGamesData();
                    });
                }
            }

            // Kategori isimlerini düzgün görüntüleme formatına dönüştür
            function getCategoryDisplayName(category) {
                const displayNames = {
                    'action': 'Aksiyon Oyunları',
                    'adventure': 'Macera Oyunları',
                    'puzzle': 'Bulmaca Oyunları',
                    'shooter': 'Nişancı Oyunları',
                    'racing': 'Yarış Oyunları',
                    'sports': 'Spor Oyunları',
                    'rpg': 'Rol Yapma Oyunları',
                    'simulation': 'Simülasyon Oyunları',
                    'strategy': 'Strateji Oyunları',
                    'other': 'Diğer Oyunlar'
                };
                
                return displayNames[category] || category;
            }

            // Show the specified view
            function showView(viewId) {
                // Tüm görünümleri gizle
                document.getElementById('homeView').style.display = 'none';
                document.getElementById('categoryView').style.display = 'none';
                document.getElementById('gameView').style.display = 'none';
                
                // İstenen görünümü göster
                document.getElementById(viewId).style.display = 'block';
            }

            // Return to the home view
            function returnToHome() {
                showView('homeView');
            }

            // Return to the category view
            function returnToGames() {
                showView('categoryView');
            }
            
            // Kategori görünümünü belirli oyunlarla doldur
            function populateCategoryView(games) {
                const gamesGrid = document.getElementById('gamesGrid');
                if (!gamesGrid) {
                    console.error('gamesGrid elementi bulunamadı');
                    return;
                }
                
                // Oyun ızgarasını temizle
                gamesGrid.innerHTML = '';
                
                // Oyunları ekle
                if (games && games.length > 0) {
                    games.forEach(game => {
                        const gameCard = createGameCard(game);
                        if (gameCard) {
                            gamesGrid.appendChild(gameCard);
                        }
                    });
                } else {
                    // Oyun yoksa mesaj göster
                    gamesGrid.innerHTML = `
                        <div style="text-align: center; grid-column: 1 / -1; padding: 40px;">
                            <h3 style="color: #ff6b9d; margin-bottom: 15px;">Bu kategoride henüz oyun bulunmuyor</h3>
                            <p style="color: #666;">Başka bir kategori seçin veya daha sonra tekrar kontrol edin.</p>
                        </div>
                    `;
                }
            }

            // Bir oyun için kart oluştur
            function createGameCard(game) {
                if (!game || !game.Title) {
                    console.error('Geçersiz oyun verisi:', game);
                    return null;
                }

                const card = document.createElement('div');
                card.className = 'game-card';
                card.setAttribute('data-id', game.Id || '');

                // Resim URL'sini belirle ve doğrula
                let imageUrl = 'https://via.placeholder.com/300x180?text=Oyun+Görseli';
                if (game.Assets && Array.isArray(game.Assets) && game.Assets.length > 0) {
                    imageUrl = game.Assets[0];
                } else if (game.Image) {
                    imageUrl = game.Image;
                } else if (game.Thumbnail) {
                    imageUrl = game.Thumbnail;
                }

                // Tür bilgisini al
                let genre = 'Oyun';
                if (game.Genres && Array.isArray(game.Genres) && game.Genres.length > 0) {
                    genre = game.Genres[0];
                } else if (game.Genre) {
                    genre = game.Genre;
                } else if (game.Category) {
                    genre = game.Category;
                }

                // Favori durumunu kontrol et
                const favorites = JSON.parse(localStorage.getItem('favoriteGames')) || [];
                const isFavorite = favorites.includes(game.Id);

                // Kart içeriğini oluştur
                card.innerHTML = `
                    <div class="game-card-image-container">
                        <div class="game-card-loading"></div>
                        <img class="lazy-image"
                             src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E"
                             data-src="${imageUrl}"
                             alt="${game.Title}"
                             loading="lazy">
                        <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-game-id="${game.Id}">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                    <div class="game-card-info">
                        <div class="game-card-title">${game.Title}</div>
                        <span class="game-card-genre">${genre}</span>
                    </div>
                `;

                // Lazy loading işlemleri için
                const img = card.querySelector('img');
                img.onload = function() {
                    this.classList.add('loaded');
                    const loadingDiv = card.querySelector('.game-card-loading');
                    if (loadingDiv) {
                        loadingDiv.style.display = 'none';
                    }
                };

                img.onerror = function() {
                    console.log('Resim yüklenemedi, placeholder kullanılıyor:', imageUrl);
                    this.src = 'https://via.placeholder.com/300x180?text=Oyun+Görseli';
                    this.classList.add('error');
                    const loadingDiv = card.querySelector('.game-card-loading');
                    if (loadingDiv) {
                        loadingDiv.style.display = 'none';
                    }
                };

                // Favori butonuna tıklama olayı
                const favoriteBtn = card.querySelector('.favorite-btn');
                favoriteBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Oyun kartının tıklama olayını engelle
                    toggleFavorite(game.Id, this);
                });

                // Oyun kartına tıklama olayı
                card.addEventListener('click', function(e) {
                    // Favori butonuna tıklanmadıysa oyun görünümüne geç
                    if (!e.target.closest('.favorite-btn')) {
                        openGameView(game);
                    }
                });

                return card;
            }

            // Oyun görünümünü aç
            function openGameView(game) {
                if (!game || !game["Game URL"]) {
                    console.error('Oyun URL bulunamadı:', game);
                    showNotification('Bu oyun için URL bilgisi bulunamadı!', 'error');
                    return;
                }

                // Oyun bilgilerini doldur
                document.getElementById('gameTitle').textContent = game.Title || 'İsimsiz Oyun';
                document.getElementById('gameDescription').textContent = game.Description || 'Bu oyun için açıklama bulunmuyor.';
                document.getElementById('gameInstructions').textContent = game.Instructions || 'Özel talimatlar bulunmuyor.';

                // Etiketleri doldur
                const tagsContainer = document.getElementById('gameTags');
                tagsContainer.innerHTML = '';

                if (game.Tags && game.Tags.length > 0) {
                    game.Tags.forEach(tag => {
                        const tagSpan = document.createElement('span');
                        tagSpan.className = 'game-tag';
                        tagSpan.textContent = tag;
                        tagsContainer.appendChild(tagSpan);
                    });
                } else if (game.Genres && game.Genres.length > 0) {
                    game.Genres.forEach(genre => {
                        const tagSpan = document.createElement('span');
                        tagSpan.className = 'game-tag';
                        tagSpan.textContent = genre;
                        tagsContainer.appendChild(tagSpan);
                    });
                }

                // Oyun iframe'ini ayarla
                const gameFrame = document.getElementById('gameFrame');

                // Loading göstergesi ekle
                gameFrame.style.display = 'none';
                const gameContainer = document.getElementById('gameContainer');
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'game-loading';
                loadingDiv.innerHTML = '<div class="loading-spinner"></div><p>Oyun yükleniyor...</p>';
                gameContainer.appendChild(loadingDiv);

                gameFrame.onload = function() {
                    // Oyun yüklendiğinde loading'i gizle
                    loadingDiv.remove();
                    gameFrame.style.display = 'block';
                    showNotification('Oyun başarıyla yüklendi!', 'success');
                };

                gameFrame.onerror = function() {
                    loadingDiv.innerHTML = '<p style="color: red;">Oyun yüklenemedi. Lütfen daha sonra tekrar deneyin.</p>';
                    showNotification('Oyun yüklenirken hata oluştu!', 'error');
                };

                gameFrame.src = game["Game URL"];

                // Oyun görünümünü göster
                showView('gameView');

                // Oyun geçmişine ekle
                addToGameHistory(game);
            }

            // Görüntü lazy loading için gözlemci ayarla
            function setupLazyLoading() {
                if ('IntersectionObserver' in window) {
                    const imageObserver = setupImageObserver();

                    // Tüm lazy-load resimlerini gözlemle
                    document.querySelectorAll('img[data-src]').forEach(img => {
                        observeImage(img, imageObserver);
                    });
                } else {
                    // IntersectionObserver desteklenmeyen tarayıcılar için fallback
                    loadVisibleImages();
                    window.addEventListener('scroll', throttle(loadVisibleImages, 100));
                    window.addEventListener('resize', throttle(loadVisibleImages, 100));
                }
            }

            // Throttle fonksiyonu - performans için
            function throttle(func, limit) {
                let inThrottle;
                return function() {
                    const args = arguments;
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }

            // Resim gözlemcisi oluştur
            function setupImageObserver() {
                return new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            const src = img.getAttribute('data-src');

                            if (src) {
                                // Loading placeholder'ı göster
                                const loadingDiv = img.closest('.game-card')?.querySelector('.game-card-loading');
                                if (loadingDiv) {
                                    loadingDiv.style.display = 'block';
                                }

                                img.src = src;
                                img.onload = function() {
                                    img.removeAttribute('data-src');
                                    img.classList.add('loaded');
                                    // Loading placeholder'ı gizle
                                    if (loadingDiv) {
                                        loadingDiv.style.display = 'none';
                                    }
                                };

                                img.onerror = function() {
                                    console.log('Resim yüklenemedi, placeholder kullanılıyor:', src);
                                    img.src = 'https://via.placeholder.com/300x180?text=Oyun+Görseli';
                                    img.classList.add('error');
                                    // Loading placeholder'ı gizle
                                    if (loadingDiv) {
                                        loadingDiv.style.display = 'none';
                                    }
                                };

                                observer.unobserve(img);
                            }
                        }
                    });
                }, {
                    rootMargin: '200px 0px',
                    threshold: 0.01
                });
            }

            // Belirli bir resmi gözlemle
            function observeImage(img, observer) {
                if (img.getAttribute('data-src')) {
                    observer.observe(img);
                }
            }

            // Görünür resimleri yükle (IntersectionObserver fallback)
            function loadVisibleImages() {
                const images = document.querySelectorAll('img[data-src]');
                const windowHeight = window.innerHeight;
                
                images.forEach(img => {
                    const rect = img.getBoundingClientRect();
                    
                    // Ekranda görünüyor mu kontrol et
                    if (rect.top <= windowHeight + 200 && rect.bottom >= -200) {
                        const src = img.getAttribute('data-src');
                        if (src) {
                            img.src = src;
                            img.onload = function() {
                                img.removeAttribute('data-src');
                                img.classList.add('loaded');
                            };
                            
                            img.onerror = function() {
                                img.src = './assets/images/placeholder.webp';
                                img.classList.add('error');
                            };
                        }
                    }
                });
            }

            // Sidebar kategori linklerine olay dinleyicileri ekle
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', async function(e) {
                    e.preventDefault();
                    const category = this.getAttribute('data-category');
                    
                    if (category === 'all') {
                        // Tüm oyunları göster
                        showView('homeView');
                        return;
                    }
                    
                    if (category === 'favorites') {
                        // Favorileri göster
                        loadFavoriteGames();
                        return;
                    }
                    
                    try {
                        // Yükleme göstergesini göster
                        const loadingIndicator = document.getElementById('loadingIndicator');
                        if (loadingIndicator) {
                            loadingIndicator.style.display = 'flex';
                            loadingIndicator.innerHTML = `<div class="loading-spinner"></div><p style="margin-left: 15px; color: #ff6b9d; font-weight: bold;">${getCategoryDisplayName(category)} yükleniyor...</p>`;
                        }

                        let categoryGames = [];

                        try {
                            // API'den kategori oyunlarını al
                            const response = await fetch(`/api/games/category/${encodeURIComponent(category)}`);

                            if (!response.ok) {
                                throw new Error(`Kategori yükleme hatası: ${response.status}`);
                            }

                            categoryGames = await response.json();
                        } catch (apiError) {
                            console.log('API kategori yükleme başarısız, yerel verilerden yükleniyor...', apiError.message);

                            // Yerel verilerden kategori oyunlarını al
                            if (gamesByCategory[category] && gamesByCategory[category].length > 0) {
                                categoryGames = gamesByCategory[category];
                            } else {
                                // Kategori bulunamadıysa tüm oyunları filtrele
                                categoryGames = performLocalCategoryFilter(category);
                            }
                        }

                        // Kategori görünümünü güncelle
                        document.getElementById('categoryTitle').textContent = getCategoryDisplayName(category);
                        populateCategoryView(categoryGames);

                        // Kategori görünümünü göster
                        showView('categoryView');

                    } catch (error) {
                        console.error('Kategori oyunları yüklenirken hata:', error);
                        showErrorMessage(`Kategori oyunları yüklenirken bir hata oluştu: ${error.message}`);
                    } finally {
                        // Yükleme göstergesini gizle
                        if (loadingIndicator) {
                            loadingIndicator.style.display = 'none';
                        }
                    }
                });
            });
            
            // Favori durumunu değiştir
            function toggleFavorite(gameId, buttonElement) {
                const favorites = JSON.parse(localStorage.getItem('favoriteGames')) || [];
                const index = favorites.indexOf(gameId);

                if (index === -1) {
                    // Favorilere ekle
                    favorites.push(gameId);
                    buttonElement.classList.add('active');
                    showNotification('Oyun favorilere eklendi!', 'success');
                } else {
                    // Favorilerden çıkar
                    favorites.splice(index, 1);
                    buttonElement.classList.remove('active');
                    showNotification('Oyun favorilerden çıkarıldı!', 'info');
                }

                // Yerel depolamaya kaydet
                localStorage.setItem('favoriteGames', JSON.stringify(favorites));
            }

            // Bildirim göster
            function showNotification(message, type = 'info') {
                // Mevcut bildirimleri temizle
                const existingNotifications = document.querySelectorAll('.notification');
                existingNotifications.forEach(n => n.remove());

                const notification = document.createElement('div');
                notification.className = `notification ${type}`;

                let icon = 'fa-info-circle';
                if (type === 'success') icon = 'fa-check-circle';
                else if (type === 'error') icon = 'fa-exclamation-circle';

                notification.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                `;

                // Bildirimi sayfaya ekle
                document.body.appendChild(notification);

                // 3 saniye sonra kaldır
                setTimeout(() => {
                    notification.classList.add('fade-out');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 3000);
            }

            // Oyun geçmişine ekle
            function addToGameHistory(game) {
                const history = JSON.parse(localStorage.getItem('gameHistory')) || [];

                // Aynı oyun varsa çıkar (en son oynanan en üstte olsun)
                const existingIndex = history.findIndex(h => h.Id === game.Id);
                if (existingIndex !== -1) {
                    history.splice(existingIndex, 1);
                }

                // Oyunu en başa ekle
                history.unshift({
                    Id: game.Id,
                    Title: game.Title,
                    playedAt: new Date().toISOString()
                });

                // En fazla 20 oyun tut
                if (history.length > 20) {
                    history.splice(20);
                }

                // Yerel depolamaya kaydet
                localStorage.setItem('gameHistory', JSON.stringify(history));
            }

            // Favori oyunları yükle
            function loadFavoriteGames() {
                // Yerel depolamadan favori oyunları al
                const favorites = JSON.parse(localStorage.getItem('favoriteGames')) || [];
                
                if (favorites.length === 0) {
                    // Favoriler boşsa mesaj göster
                    document.getElementById('categoryTitle').textContent = 'Favoriler';
                    const gamesGrid = document.getElementById('gamesGrid');
                    gamesGrid.innerHTML = `
                        <div style="text-align: center; grid-column: 1 / -1; padding: 40px;">
                            <h3 style="color: #ff6b9d; margin-bottom: 15px;">Henüz favori oyununuz yok</h3>
                            <p style="color: #666;">Oyun kartlarındaki kalp simgesine tıklayarak favorilerinize oyun ekleyebilirsiniz.</p>
                        </div>
                    `;
                    showView('categoryView');
                    return;
                }
                
                // Favori oyunları filtrele - tüm kategorilerden
                const favoriteGames = [];
                Object.keys(gamesByCategory).forEach(category => {
                    gamesByCategory[category].forEach(game => {
                        if (game && game.Id && favorites.includes(game.Id)) {
                            // Aynı oyunu birden fazla kez eklememek için kontrol et
                            const existingIndex = favoriteGames.findIndex(f => f.Id === game.Id);
                            if (existingIndex === -1) {
                                favoriteGames.push(game);
                            }
                        }
                    });
                });

                // Kategori görünümünü güncelle
                document.getElementById('categoryTitle').textContent = `Favoriler (${favoriteGames.length} oyun)`;
                populateCategoryView(favoriteGames);

                // Kategori görünümünü göster
                showView('categoryView');
            }

            // Initialize the site
            loadGamesData();
        });
    </script>
</body>
</html> 